{% extends "base.html" %}

{% block content %}
<!-- Removed title and redesigned results page with clean professional layout -->
<div class="results-page">
    <div class="container">
        <div class="page-header">
            <a href="{{ url_for('filters') }}" class="back-link">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                Back to filters
            </a>
        </div>

        <div class="results-content">
            <!-- Progress Card -->
            <div class="progress-card">
                <div class="progress-header">
                    <div class="progress-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="progress-title">Analysis Progress</h2>
                        <p class="progress-subtitle">Your analysis request is being processed</p>
                    </div>
                </div>

                <div class="progress-content">
                    <div class="progress-info">
                        <span class="progress-step" id="current-step">Initializing analysis...</span>
                        <span class="progress-percent" id="progress-percent">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>

                    <div class="status-info">
                        <div class="status-header">
                            <span class="status-label">Current Status:</span>
                            <span class="status-value" id="status-text">Processing</span>
                        </div>
                        <p class="status-message" id="status-message">
                            Please wait while we process your trial data request. This typically takes 2-3 minutes.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Request Details Card -->
            <div class="details-card">
                <h3 class="details-title">Request Details</h3>
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">Requested Date:</span>
                        <span class="detail-value">{{ request_time.strftime('%B %d, %Y at %I:%M %p') }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Username:</span>
                        <span class="detail-value">john.analyst@bain.com</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Request ID:</span>
                        <span class="detail-value">{{ request_id }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Date Range:</span>
                        <span class="detail-value">January 2015 - July 2025</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Estimated Results:</span>
                        <span class="detail-value">~15,000 trials</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Data Source:</span>
                        <span class="detail-value">CT + TT (Default)</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-secondary" id="share-btn" disabled>
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                    </svg>
                    Start another analysis
                </button>
                <button class="btn-primary" id="download-btn" disabled>
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Download Results
                </button>
            </div>

            <!-- Success Card (hidden initially) -->
            <div class="success-card hidden" id="success-card">
                <div class="success-icon">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="success-title">Analysis Complete!</h3>
                <p class="success-message">
                    Your BCN PEG TrialSights analysis has been successfully generated. The results include detailed trial data,
                    statistical insights, and visualization charts ready for your presentation.
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Simple progress simulation without external dependencies
function updateProgress() {
    fetch('/api/progress')
        .then(response => response.json())
        .then(data => {
            document.getElementById('progress-bar').style.width = data.progress + '%';
            document.getElementById('progress-percent').textContent = data.progress + '%';
            document.getElementById('current-step').textContent = data.step;
            
            if (data.status === 'ready') {
                document.getElementById('status-text').textContent = 'Results Ready';
                document.getElementById('status-text').className = 'status-value status-ready';
                document.getElementById('status-message').textContent = 'Your analysis is complete! You can now download the results.';
                document.getElementById('status-message').className = 'status-message status-ready';
                document.getElementById('download-btn').disabled = false;
                document.getElementById('share-btn').disabled = false;
                document.getElementById('success-card').classList.remove('hidden');
            } else {
                setTimeout(updateProgress, 1000);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            setTimeout(updateProgress, 2000);
        });
}

// Start progress updates
updateProgress();
</script>
{% endblock %}
